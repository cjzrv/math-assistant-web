<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å°å­¸æ•¸å­¸åŠ©æ‰‹</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
  <style>
    .answer-reveal {
      margin-top: 1em;
      display: none;
      background: #fff3cd;
      border: 1px solid #ffeeba;
      padding: 1em;
      border-radius: 6px;
      color: #856404;
    }
    .reveal-btn {
      background: transparent;
      border: none;
      color: transparent;
      padding: 0;
      margin-top: 1em;
      cursor: pointer;
      float: right;
    }
    .button-group {
      display: flex;
      gap: 1em;
      margin-top: 1em;
    }
  </style>
  <script>
    function toggleLanguage() {
      const url = new URL(window.location.href);
      const currentLang = url.searchParams.get("lang") || "zh";
      const nextLang = currentLang === "zh" ? "en" : "zh";
      url.searchParams.set("lang", nextLang);
      window.location.href = url.toString();
    }
    function toggleAnswer() {
      const answerBox = document.getElementById("correct-answer");
      answerBox.style.display = (answerBox.style.display === "none" || answerBox.style.display === "") ? "block" : "none";
    }
  </script>
</head>
<body>
<div class="container">
  {% if not response %}
  <button class="lang-switch" onclick="toggleLanguage()">
    ğŸŒ {{ 'åˆ‡æ›è‹±æ–‡' if lang == 'zh' else 'Switch to Chinese' }}
  </button>
  {% endif %}

  <h1>{{ 'ğŸ“ å°å­¸æ•¸å­¸å­¸ç¿’åŠ©æ‰‹' if lang == 'zh' else 'ğŸ“ Elementary Math Assistant' }}</h1>

  <div class="question">
    <strong>{{ 'ğŸ“Œ é¡Œç›®ï¼š' if lang == 'zh' else 'ğŸ“Œ Question: ' }}</strong> {{ question }}
  </div>

  {% if not response %}
  <form method="post" action="/answer">
    <input type="hidden" name="question" value="{{ question }}">
    <input type="hidden" name="correct_answer" value="{{ correct_answer }}">
    <input type="hidden" name="history_json" value='{{ history_json | default("[]") }}'>
    <input type="hidden" name="lang" value="{{ lang }}">

    <label for="user_answer">{{ 'âœï¸ è«‹è¼¸å…¥ä½ çš„ç­”æ¡ˆï¼š' if lang == 'zh' else 'âœï¸ Please enter your answer:' }}</label>
    <textarea name="user_answer" required></textarea>
    <br>
    <div class="button-group">
      <button type="submit">{{ 'é€å‡ºç­”æ¡ˆ' if lang == 'zh' else 'Submit Answer' }}</button>
      <a href="/?lang={{ lang }}" style="text-decoration: none;"><button type="button">{{ 'ä¸‹ä¸€é¡Œ' if lang == 'zh' else 'Next Question' }}</button></a>
    </div>
    <button class="reveal-btn" onclick="event.preventDefault(); toggleAnswer();">{{ 'é¡¯ç¤ºç­”æ¡ˆ' if lang == 'zh' else 'Reveal Answer' }}</button>
  </form>
  {% else %}
  <form method="post" action="/followup" style="margin-top: 2em;">
    <input type="hidden" name="question" value="{{ question }}">
    <input type="hidden" name="correct_answer" value="{{ correct_answer }}">
    <input type="hidden" name="history_json" value='{{ history_json | default("[]") }}'>
    <input type="hidden" name="lang" value="{{ lang }}">

    <label for="followup">{{ 'ğŸ’¬ ä½ æœ‰å…¶ä»–å•é¡Œå—ï¼Ÿ' if lang == 'zh' else 'ğŸ’¬ Do you have another question?' }}</label>
    <input type="text" name="followup" placeholder="{{ 'ä¾‹å¦‚ï¼šç‚ºä»€éº¼é€™æ¨£ç®—ï¼Ÿ' if lang == 'zh' else 'e.g. Why is it calculated this way?' }}" required>
    <div class="button-group">
      <button type="submit">{{ 'è¿½å•å•é¡Œ' if lang == 'zh' else 'Follow-up' }}</button>
      <a href="/?lang={{ lang }}" style="text-decoration: none;"><button type="button">{{ 'ä¸‹ä¸€é¡Œ' if lang == 'zh' else 'Next Question' }}</button></a>
    </div>
  </form>
  {% endif %}

  <div id="correct-answer" class="answer-reveal">
    âœ… {{ 'æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š' if lang == 'zh' else 'The correct answer is:' }} <strong>{{ correct_answer }}</strong>
  </div>

  {% if response %}
    <div class="response-box">
      {{ 'ğŸ“– LLM å›è¦†ï¼š' if lang == 'zh' else 'ğŸ“– LLM Response:' }}<br>{{ response | safe }}
    </div>
  {% endif %}

  {% if chat_history %}
    <div class="chat">
      <h3>{{ 'ğŸ§  å°è©±æ­·ç¨‹' if lang == 'zh' else 'ğŸ§  Conversation History' }}</h3>
      {% for entry in chat_history %}
        <div class="chat-entry">
          {% if entry.user %}<div class="user">ğŸ‘© {{ 'å­¸ç”Ÿ' if lang == 'zh' else 'Student' }}ï¼š{{ entry.user }}</div>{% endif %}
          {% if entry.assistant %}<div class="assistant">ğŸ§‘â€ğŸ« {{ 'è€å¸«' if lang == 'zh' else 'Teacher' }}ï¼š{{ entry.assistant | safe }}</div>{% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
</body>
</html>
